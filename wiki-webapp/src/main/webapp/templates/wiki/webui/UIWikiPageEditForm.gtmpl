<%
  import java.util.List;
  
  uicomponent.checkToDissplayNotification();

  def rcontext = _ctx.getRequestContext() ;  
//rcontext.getJavascriptManager().addJavascript("eXo.wiki.UIWikiPageEditForm.editPageContent('" + uicomponent.id + "');");
   def requireJs = rcontext.getJavascriptManager().getRequireJS();
   requireJs.require("SHARED/wiki-edit", "wikiEdit");
  def saveDraftSuccessMessage = _ctx.appRes("DraftPage.msg.save-draft-success");
  def discardDraftConfirmMessage = _ctx.appRes("DraftPage.msg.keep-draft-question");
  
  // Resource for cancel action
  def cancelDraftConfirmTitle = _ctx.appRes("UIConfirmBox.label.Confirmation");
  def cancelDraftConfirmMessage = _ctx.appRes("DraftPage.msg.cancel-draft");
  def yesButtonLabel = _ctx.appRes("DraftPage.label.yes-button");
  def noButtonLabel = _ctx.appRes("DraftPage.label.no-button");
  def removeDraftRestUrl = uicomponent.getRemoveDraftRestUrl();
  
  def removeDraftAction = uicomponent.getCancelDraftEvent();
  def saveDraftRestUrl = uicomponent.getSaveDraftRestUrl();
  def wikiType = uicomponent.getWikiType();
  def wikiOwner = uicomponent.getWikiOwner();
  def pageId = uicomponent.getCurrentPageId();
  def initDraftName = uicomponent.getInitDraftName();
  def pageRevision = uicomponent.getCurrentPageRevision();
  boolean isRunAutoSave = uicomponent.isRunAutoSave();
  boolean isDraftForNewPage = uicomponent.isNewPage();
  long getAutoSaveSequenceTime = uicomponent.getAutoSaveSequenceTime();
  List notificationMessages = uicomponent.getNotificationMessages();
  String untitledLabel = _ctx.appRes("UIWikiPageTitleControlArea.label.Untitled");
  
  requireJs.addScripts("wikiEdit.UIWikiPageEditForm.init('" + uicomponent.id + "', '" + saveDraftRestUrl + "', " + isRunAutoSave + ", '" + pageRevision + "', " + isDraftForNewPage + ", " + getAutoSaveSequenceTime + ", '" + untitledLabel + "');");
  requireJs.addScripts("wikiEdit.UIWikiPageEditForm.setMessageResource('" + saveDraftSuccessMessage + "', '" + discardDraftConfirmMessage + "');");
  requireJs.addScripts("wikiEdit.UIWikiPageEditForm.setCancelDraftAction('" + removeDraftRestUrl + "', '" + cancelDraftConfirmTitle + "', '" + cancelDraftConfirmMessage + "', '" + yesButtonLabel + "', '" + noButtonLabel + "');");
  requireJs.addScripts("wikiEdit.UIWikiPageEditForm.setRestParam('" + wikiType + "', '" + wikiOwner + "', '" + pageId + "', '" + initDraftName + "');");
  requireJs.addScripts("wikiEdit.UIWikiPageEditForm.synPublishActivityCheckboxesStatus('" + uiform.FIELD_PUBLISH_ACTIVITY_UPPER + "','" + uiform.FIELD_PUBLISH_ACTIVITY_BOTTOM + "');");
%>
<div class="uiWikiPageEditForm">
<% uiform.begin();%>


<!--
<<<<<<< HEAD
  <div class="UIEditUpper clearfix">
    <% uiform.renderChild(uiform.TITLE_CONTROL); %>
    <div class="UIWikiPageEditForm_MessageArea" style="float:left"></div>
    <div class="RightWrap">
    <%
      uiform.renderChild(uiform.SUBMIT_TOOLBAR_UPPER);
      if(uiform.getChildById(uiform.FIELD_PUBLISH_ACTIVITY_UPPER).isRendered()) {
    %>
        <label class="PublishActivityCheckBoxTitle" for="<%=uiform.FIELD_PUBLISH_ACTIVITY_UPPER%>"><%uiform.renderField(uiform.FIELD_PUBLISH_ACTIVITY_UPPER);%><%= _ctx.appRes("UIWikiPageEditForm.label.PublishActivityCheckBoxTitle"); %></label>
    <%}
    %>
    </div>
  </div>
  <%
   uiform.renderChild(uiform.FIELD_TEMPLATEDESCTIPTION);  
  %>
  <div class="clearfix actionContainer">
  <%
   uiform.renderChild(uiform.EDITOR_TABS);
  %>
  </div>

  <div class="UIWikiNotificationContainer clearfix">
    <% for(String message : notificationMessages) { %>
      <%= message %>
    <% } %>
  </div>
-->


  <div class="uiWikiPageContainer clearfix">
  <%
    uiform.renderChild(uiform.HELP_PANEL);
    textAreaInput = uiform.getUIFormTextAreaInput(uiform.FIELD_CONTENT)
    textAreaInput.setRows(25);
    if(uicomponent.isSidePanelRendered() && uiform.getUIFormTextAreaInput(uiform.FIELD_CONTENT).isRendered()){
      textAreaInput.setColumns(92);
  %>
	<div class="uiColsLeftsEditForm">
	  <div class="uiEditUpper">
		<%
		  uiform.renderChild(uiform.TITLE_CONTROL);
		%>
		
	  </div>
	  <%
	   uiform.renderChild(uiform.FIELD_TEMPLATEDESCTIPTION);  
	  %>
	  <div class="actionContainer clearfix">
<!--		  <%
		   uiform.renderChild(uiform.EDITOR_TABS);
		  %>
-->
		<div class="btn-toolbar">
			<div class="btn-group uiEditorTabs pull-left clearfix" id="UIEditorTabs">
				<button class="btn" href="javaScript:void(0)" onclick="javascript:eXo.webui.UIForm.submitEvent('41c460ee-13b5-4e2a-968c-9888fc06816f#UIWikiPageEditForm','RichText','&amp;subComponentId=UIEditorTabs_RichText_&amp;objectId=RichText')"><i class="uiIconRickText"></i>  Rich Text</button>
				<button class="btn " href="javaScript:void(0)" onclick="javascript:eXo.webui.UIForm.submitEvent('41c460ee-13b5-4e2a-968c-9888fc06816f#UIWikiPageEditForm','PreviewPage','&amp;subComponentId=UIEditorTabs_PreviewPage_&amp;objectId=PreviewPage')"><i class="uiIconWatchPage"></i>  Preview</button>
				<button class="btn " href="javaScript:void(0)" onclick="javascript:eXo.webui.UIForm.submitEvent('41c460ee-13b5-4e2a-968c-9888fc06816f#UIWikiPageEditForm','Help','&amp;subComponentId=UIEditorTabs_Help_&amp;objectId=Help')"><i class="uiIconHelp"></i>  Help</button>
			</div>
		</div>
	
	
		  <div class="pull-left">Draft saved at 19:45</div>
		<div class="pull-right clearfix">
		  
			<%
			  uiform.renderChild(uiform.SUBMIT_TOOLBAR_UPPER);
			  if(uiform.getChildById(uiform.FIELD_PUBLISH_ACTIVITY_UPPER).isRendered()) {
			%>
			
				<!--label class="uiCheckbox" style="border: 1px solid red">
					<input type="checkbox" /> 
					<span>Publish Activity</span>
				</label-->

				<label class="uiCheckbox pull-right" for="<%=uiform.FIELD_PUBLISH_ACTIVITY_UPPER%>"><%uiform.renderField(uiform.FIELD_PUBLISH_ACTIVITY_UPPER);%><span><%= _ctx.appRes("UIWikiPageEditForm.label.PublishActivityCheckBoxTitle"); %></span></label>

			<%}
			%>
		</div>
	  </div>
      <div class="uiWikiPageContentInputContainer">
        <% uiform.renderField(uiform.FIELD_CONTENT); %>
      </div>
    </div>
  <%} else if(uiform.getUIFormTextAreaInput(uiform.FIELD_CONTENT).isRendered()) {
      textAreaInput.setColumns(128);
  %>
    <div class="UIWikiPageContentInputContainer">
      <% uiform.renderField(uiform.FIELD_CONTENT); %>
    </div>
  <%} %>
  <% uiform.renderChild(uiform.RICHTEXT_AREA);%>
  
	
   <div class="form-horizontal clearfix">
	<div class="control-group pull-left">
  <% if(uiform.getChildById(uiform.FIELD_COMMENT).isRendered()) { %>
      <label class="control-label" for="<%=uiform.FIELD_COMMENT%>"><%= _ctx.appRes("UIWikiPageEditForm.label.CommentTitle"); %></label>
	  <div class="controls">
  <%
       uiform.renderField(uiform.FIELD_COMMENT);
     }%>
	 </div>
	 <%
     if(uiform.getChildById(uiform.FIELD_PUBLISH_ACTIVITY_BOTTOM).isRendered()) {
  %>	</div>
       <label class="uiCheckbox pull-left" for="<%=uiform.FIELD_PUBLISH_ACTIVITY_BOTTOM%>"><%uiform.renderField(uiform.FIELD_PUBLISH_ACTIVITY_BOTTOM);%><span><%= _ctx.appRes("UIWikiPageEditForm.label.PublishActivityCheckBoxTitle"); %></span></label>
  
    </div>

 <% }
    uiform.renderChild(uiform.SUBMIT_TOOLBAR_BOTTOM);  
   %>
  </div>
<% uiform.end();%>
</div>
